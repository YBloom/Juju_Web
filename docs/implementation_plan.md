# 实施计划 (V6) - MusicalMatch MVP

# 系统愿景
**"最懂剧迷的智能票务撮合引擎"**

## 当前状态
> [!NOTE]
> **阿里云 Bot 正常运行中**，AWS 版为渐进式迁移，非紧急。
> 目标：功能对齐后，逐步废弃阿里云服务。

## Bot vs Web 职责划分
| 平台 | 定位 | 承担功能 |
|---|---|---|
| **QQ Bot** | 即时触达 + 快查 | 通知推送、`/hlq`、`/date`、订阅开关 |
| **Web (yaobii)** | 深度交互 + 可视化 | 同场演员、热力图、座位揭秘、订阅管理面板 |

**原则**: Bot 遇到复杂查询 -> 返回 Web 链接，引导用户去 Web 看。

---

## 阶段规划

### Phase 1: Bot-Web 互通基础
**目标**: 打通身份认证 + 建立 Bot->Web 引流机制。

#### 1.1 Magic Link 登录
-   [NEW] `services/bot/handlers.py`: `/web` 指令生成 JWT Token。
-   [NEW] `services/web/blueprints/auth.py`: 校验 Token，创建 Session。

#### 1.2 深链接引流 (重定向模式)
-   **示例**: 用户发送 `/同场演员 丁辰西 陈玉婷`。
-   **Bot 响应**: `🔍 同场演员查询已升级至 Web 版！\n👉 点击查看: https://yaobii.com/co-cast?actors=丁辰西,陈玉婷`

---

### Phase 2: 迁移核心功能到 AWS Bot
**目标**: 与阿里云 Bot 功能对齐，为切换做准备。

| 功能 | 实现方式 |
|---|---|
| 通知推送 | 对接 Hulaquan 变更检测，私聊推送 |
| `/hlq <剧名>` | 快速余票查询 (Bot 直接返回摘要) |
| `/date <日期>` | 按日期查场次 (Bot 直接返回摘要) |
| `/同场演员` | **重定向到 Web** (如上) |
| `/订阅` | 简单开关在 Bot，详细管理去 Web |

---

### Phase 3: Web 深度功能
**目标**: 承接 Bot 引流过来的复杂需求。

-   [NEW] 同场演员可视化页面 (`/co-cast`)。
-   [NEW] 座位揭秘系统。
-   [NEW] 订阅管理面板。

---

## 验证计划

### Phase 1 验证
1.  **Magic Link**: 私聊 `/web` -> 点击链接 -> Web 显示"已登录"。
2.  **重定向**: 发送 `/同场演员 演员名` -> 收到 Web 链接 -> 点击能打开对应页面。

### Phase 2 验证
1.  **功能对比**: AWS Bot `/hlq` 返回结果与阿里云 Bot 一致。
2.  **通知测试**: 触发变更 -> 验证私聊收到推送。

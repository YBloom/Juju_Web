<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicalBot Web</title>
    <link rel="icon" type="image/png" href="/static/img/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;500;600;700&family=Material+Icons&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css?v=20260105_2">
    <link rel="stylesheet" href="/static/css/feedback.css?v=20260105">

    <!-- Pinyin Library for Autocomplete -->
    <script src="https://unpkg.com/pinyin-pro@3.18.2/dist/index.js"></script>

    <!-- Umami Analytics -->
    <!-- 登录 https://analytics.yaobii.com 创建网站后,替换 YOUR_WEBSITE_ID -->
    <script defer src="https://analytics.yaobii.com/script.js"
        data-website-id="65e0c212-9644-47e1-a5f4-9dc3b27cffd8"></script>
</head>

<body>
    <div id="app"></div>


    <div class="nav-ribbon">
        <button class="nav-btn" data-tab="tab-hlq" onclick="router.navigate('/')"><i class="material-icons">list</i>
            呼啦圈剧目</button>
        <button class="nav-btn" data-tab="tab-date" onclick="router.navigate('/date')"><i
                class="material-icons">event</i>
            学生票日历</button>
        <button class="nav-btn" data-tab="tab-cocast" onclick="router.navigate('/cocast')"><i
                class="material-icons">people</i> 同场演员</button>
        <button class="nav-btn" data-tab="tab-lab" onclick="router.navigate('/lab')"><i
                class="material-icons">palette</i>
            数据艺廊</button>
    </div>

    <main>
        <!-- Hulaquan List Tab -->
        <!-- 呼啦圈列表标签页 -->
        <div id="tab-hlq" class="tab-content active">
            <div class="header-section" style="text-align: center; padding: 40px 20px 20px;">
                <h3 style="margin: 0; color: var(--primary-color); font-size: 1.5rem; font-weight: 700;">全部剧目</h3>
                <p style="margin: 8px 0 0; color: var(--text-secondary); font-size: 0.9rem;">浏览呼啦圈所有在售演出信息</p>
            </div>
            <div class="toolbar" style="justify-content: center; padding: 0 20px 20px;">
                <!-- Existing controls like city filter and column toggles will be injected here -->
            </div>

            <!-- 票务动态卡片 (Ticket Updates Dashboard) -->
            <div class="ticket-updates-card" id="ticket-updates-card">
                <div class="updates-header">
                    <h4><i class="material-icons" style="color: #22c55e;">flight_takeoff</i> 票务动态</h4>
                    <i class="material-icons expand-icon">expand_more</i>
                </div>
                <div class="updates-body" id="updates-body">
                    <div class="updates-filters">
                        <label title="新增加的场次或票档"><input type="checkbox" class="filter-type" value="new" checked><i
                                class="material-icons">add_circle_outline</i> 上新</label>
                        <label title="即将开售的场次"><input type="checkbox" class="filter-type" value="pending" checked><i
                                class="material-icons">schedule</i> 开票</label>
                        <label title="此前锁定的区域或座位重新开放"><input type="checkbox" class="filter-type" value="back" checked><i
                                class="material-icons">replay</i> 补票</label>
                        <label title="因退票或超时未支付而重新上架的票"><input type="checkbox" class="filter-type" value="restock"><i
                                class="material-icons">sync</i> 回流</label>
                        <label class="toggle-cast"><input type="checkbox" id="show-cast-toggle"> 显示卡司</label>
                    </div>
                    <div class="updates-scroll" id="updates-list">
                        <!-- Content will be loaded via JS -->
                        <div style="text-align:center; padding:20px; color:#666;">正在获取最新动态...</div>
                    </div>
                </div>
            </div>

            <div id="hlq-list-container">
                <!-- Table will be rendered here -->
            </div>
        </div>

        <!-- Detail View (Hidden by default, overlays list) -->
        <!-- 详情视图（默认隐藏，覆盖在列表上方） -->
        <div id="detail-view" class="hidden">
            <button class="back-btn" onclick="router.back()"><i class="material-icons">arrow_back</i> 返回</button>
            <div id="detail-content"></div>
        </div>

        <!-- Date Tab -->
        <div id="tab-date" class="tab-content">
            <div class="date-search-header" style="text-align: center; padding: 40px 20px 20px;">
                <h3 style="margin: 0; color: var(--primary-color); font-size: 1.5rem; font-weight: 700;">学生票日历</h3>
                <p style="margin: 8px 0 0; color: var(--text-secondary); font-size: 0.9rem;">查看呼啦圈近期在售的学生票演出安排</p>
            </div>
            <div class="input-panel" style="padding: 20px 20px 20px; text-align: center;">
                <div
                    style="display: inline-flex; align-items: center; background: #fff; padding: 8px 16px; border-radius: 50px; border: 1px solid var(--border-color); box-shadow: 0 2px 8px rgba(0,0,0,0.03); margin-bottom: 15px;">
                    <i class="material-icons"
                        style="color: var(--primary-color); margin-right: 10px; font-size: 1.2rem;">calendar_today</i>
                    <input type="date" id="date-input" onchange="doDateSearch()"
                        style="border: none; outline: none; font-size: 1rem; color: var(--text-primary); cursor: pointer; background: transparent;">
                </div>
                <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                    <button class="back-btn" style="margin-bottom: 0; padding: 6px 15px; font-size: 0.85rem;"
                        onclick="setQuickDate('today')">今天</button>
                    <button class="back-btn" style="margin-bottom: 0; padding: 6px 15px; font-size: 0.85rem;"
                        onclick="setQuickDate('weekend')">本周末</button>
                    <button class="back-btn" style="margin-bottom: 0; padding: 6px 15px; font-size: 0.85rem;"
                        onclick="setQuickDate('next_weekend')">下周末</button>
                </div>
            </div>
            <div id="date-results"></div>
        </div>

        <!-- Co-Cast Tab -->
        <div id="tab-cocast" class="tab-content">
            <div class="header-section cocast-header-styled">
                <h3 style="margin: 0; color: var(--primary-color); font-size: 1.5rem; font-weight: 700;">同场演员查询</h3>
                <p style="margin: 8px 0 0; color: var(--text-secondary); font-size: 0.9rem;">查询多位演员共同出演的场次</p>
            </div>
            <div class="cocast-panel" style="margin-top: 0;">
                <div id="cocast-inputs">
                    <div class="cocast-row">
                        <div class="input-wrapper">
                            <input type="text" class="cast-name-input" placeholder="输入演员A姓名" autocomplete="off">
                        </div>
                        <button class="circle-btn add" onclick="addCastInput()" title="增加演员">
                            <i class="material-icons">add</i>
                        </button>
                    </div>
                </div>

                <div
                    style="display: flex; justify-content: center; align-items: center; gap: 15px; background: rgba(99, 126, 96, 0.05); padding: 12px; border-radius: 12px; border: 1px solid rgba(99, 126, 96, 0.1); flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <span style="font-size: 0.9rem; color: var(--text-secondary);">查询范围：</span>
                        <label
                            style="display: flex; align-items: center; cursor: pointer; font-size: 0.9rem; color: var(--text-primary); font-weight: 500;">
                            <input type="checkbox" id="student-only-toggle"
                                style="margin-right: 6px; accent-color: var(--primary-color);"> 仅呼啦圈学生票
                        </label>
                    </div>
                    <div style="width:1px; height:20px; background:var(--border-color); display: none;"></div>
                    <div
                        style="display: inline-flex; align-items: center; gap: 10px; background: #fff; padding: 4px 12px; border-radius: 50px; border: 1px solid var(--border-color);">
                        <span style="font-size: 0.8rem; color: var(--text-secondary);">从</span>
                        <input type="date" id="cocast-start-date" min="2023-01-01"
                            style="border: none; outline: none; font-size: 0.85rem; color: var(--text-primary); cursor: pointer; background: transparent;">
                        <span style="font-size: 0.8rem; color: var(--text-secondary);">至</span>
                        <input type="date" id="cocast-end-date" min="2023-01-01"
                            style="border: none; outline: none; font-size: 0.85rem; color: var(--text-primary); cursor: pointer; background: transparent;">
                    </div>
                    <button class="back-btn"
                        style="margin-bottom: 0; padding: 4px 12px; font-size: 0.75rem; border-style: dashed; opacity: 0.8;"
                        onclick="setCoCastRange('earliest')">最早 (2023)</button>
                    <button class="back-btn"
                        style="margin-bottom: 0; padding: 4px 12px; font-size: 0.75rem; border-style: dashed; opacity: 0.8;"
                        onclick="setCoCastRange('today')">今日</button>
                </div>
                <div class="cocast-actions" style="margin-top: 25px; text-align: center;">
                    <button class="search-btn" onclick="doCoCastSearch()"
                        style="width: 100%; max-width: 200px; padding: 12px 24px; font-size: 1.05rem; box-shadow: 0 4px 12px rgba(99, 126, 96, 0.2);"><i
                            class="material-icons" style="margin-right: 8px; vertical-align: middle;">search</i>
                        查询</button>
                </div>
            </div>
            <div id="cast-results"></div>
        </div>

        <!-- Visualization Lab Tab -->
        <div id="tab-lab" class="tab-content">
            <!-- 顶部画廊介绍 -->
            <div class="lab-header">
                <h2 class="lab-welcome-title">数据艺廊</h2>
                <p class="lab-welcome-text">用另一种视角，探索演出数据</p>
            </div>
            <!-- Bento Grid 布局 -->
            <div class="lab-gallery-grid">
                <!-- 主卡片：热力图 -->
                <div class="gallery-card card-heatmap" onclick="router.navigate('/lab/heatmap')">
                    <div class="card-content">
                        <div class="card-label">2025 年度收录</div>
                        <h3 class="card-title">演出热力图</h3>
                        <p class="card-desc">查看 <strong>8,886</strong> 场演出的时间分布</p>
                        <div class="card-visual-preview">
                            <!-- CSS 绘制的抽象热力点阵装饰 -->
                            <div class="heat-dots"></div>
                        </div>
                    </div>
                    <div class="card-action">
                        <span>查看详情</span>
                        <i class="material-icons">arrow_forward</i>
                    </div>
                </div>
                <!-- 副卡片：关系网 (占位) -->
                <div class="gallery-card card-galaxy coming-soon">
                    <div class="card-content">
                        <div class="card-label">人物关系</div>
                        <h3 class="card-title">共演网络</h3>
                        <p class="card-desc">探索演员的合作关系</p>
                    </div>
                    <div class="card-icon-bg">
                        <i class="material-icons">hub</i>
                    </div>
                </div>
                <!-- 小卡片：更多 (占位) -->
                <div class="gallery-card card-more coming-soon">
                    <div class="card-center">
                        <i class="material-icons">more_horiz</i>
                        <span>更多功能开发中</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Heatmap Detail Tab (Hidden by default) -->
        <div id="tab-lab-heatmap" class="tab-content">
            <div class="heatmap-page">
                <div class="heatmap-header-area">
                    <button class="icon-back-btn" onclick="router.navigate('/lab')">
                        <i class="material-icons">arrow_back</i>
                    </button>
                    <div class="heatmap-meta">
                        <h2>2025 演出时间轴</h2>
                        <div class="year-selector">
                            <span>2026</span>
                            <span class="active">2025</span>
                            <span>2024</span>
                            <span>2023</span>
                        </div>
                    </div>
                </div>
                <!-- 图表容器：白色画框风格 -->
                <div class="chart-frame">
                    <div class="chart-stats-row">
                        <div class="stat-box">
                            <span class="stat-label">演出总数</span>
                            <span class="stat-num" id="hm_total">-</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-label">单日峰值</span>
                            <span class="stat-num" id="hm_peak">-</span>
                        </div>
                    </div>
                    <div id="heatmap-chart"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Feedback Footer Entry -->
    <div class="feedback-footer-entry">
        <div class="feedback-card" id="feedback-entry-card">
            <div class="feedback-icon">
                <i class="material-icons">rate_review</i>
            </div>
            <div class="feedback-text">
                <div class="feedback-title">反馈与建议</div>
                <div class="feedback-desc">发现Bug或有改进建议？告诉我们</div>
            </div>
            <i class="material-icons" style="color: var(--text-secondary);">chevron_right</i>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="feedback-modal-overlay" id="feedback-overlay">
        <div class="feedback-modal">
            <div class="feedback-hero-section">
                <div class="feedback-header">
                    <h3>意见反馈</h3>
                    <button class="close-modal-btn" id="feedback-close-btn">
                        <i class="material-icons">close</i>
                    </button>
                </div>

                <div class="feedback-tabs">
                    <div class="feedback-tab active" id="fb-tab-submit">我要反馈</div>
                    <div class="feedback-tab" id="fb-tab-wall">反馈动态</div>
                </div>
            </div>

            <!-- Views Wrapper for Grid Transition -->
            <div class="feedback-views-wrapper">
                <!-- View: Submit Form -->
                <div class="modal-content-area feedback-view-section active" id="fb-view-submit">
                    <form id="feedback-form">
                        <div class="feedback-form-group">
                            <label class="feedback-label">反馈类型</label>
                            <div class="feedback-type-options">
                                <label class="type-option">
                                    <input type="radio" name="feedback-type" value="bug">
                                    <div class="type-card">
                                        <i class="material-icons">bug_report</i>
                                        <span>Bug反馈</span>
                                    </div>
                                </label>
                                <label class="type-option">
                                    <input type="radio" name="feedback-type" value="suggestion" checked>
                                    <div class="type-card">
                                        <i class="material-icons">lightbulb</i>
                                        <span>优化建议</span>
                                    </div>
                                </label>
                                <label class="type-option">
                                    <input type="radio" name="feedback-type" value="wish">
                                    <div class="type-card">
                                        <i class="material-icons">auto_awesome</i>
                                        <span>功能许愿</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="feedback-form-group">
                            <label class="feedback-label">*反馈内容</label>
                            <textarea class="feedback-textarea" id="feedback-content"
                                placeholder="请详细描述您遇到的问题或您的建议..."></textarea>
                        </div>

                        <div class="feedback-form-group">
                            <label class="feedback-label">昵称（选填）</label>
                            <input type="text" class="feedback-input-clean" id="feedback-contact"
                                placeholder="怎么称呼您？/ 若收入精选反馈，将作为昵称">
                        </div>

                        <button type="submit" class="feedback-submit-btn" id="feedback-submit-btn">
                            <span class="material-icons">send</span>
                            <span class="btn-text">提交反馈</span>
                        </button>
                    </form>

                </div>

                <!-- View: Feedback Wall -->
                <div class="modal-content-area feedback-view-section slide-right" id="fb-view-wall">
                    <div class="feedback-wall-list" id="feedback-wall-list">
                        <!-- JS Populated -->
                    </div>
                </div>
            </div> <!-- End Wrapper -->
        </div>
    </div>

    <footer style="margin-top: 0px; margin-bottom: 20px;">
        <div style="text-align: center; padding: 20px; color: var(--text-secondary); font-size: 0.8rem; opacity: 0.5;">
            <div>数据来源：<a href="https://y.saoju.net/yyj" target="_blank"
                    style="color: inherit; text-decoration: underline;">y.saoju.net/yyj</a>，呼啦圈</div>
            <div>联系邮箱：<a href="mailto:contact@yaobii.com"
                    style="color: inherit; text-decoration: underline;">contact@yaobii.com</a></div>
            <div id="update-status" style="margin-top: 8px; font-size: 0.75rem;">正在加载更新状态...</div>
            <div style="margin-top: 8px;"><a href="#" id="version-link" class="version-link">v1.2</a></div>
        </div>
    </footer>

    <!-- Changelog Modal -->
    <div class="changelog-modal-overlay" id="changelog-overlay">
        <div class="changelog-modal">
            <div class="changelog-header">
                <h3><i class="material-icons">new_releases</i> 更新日志</h3>
                <button class="close-modal-btn" id="changelog-close-btn">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <div class="changelog-content">
                <div class="changelog-version">
                    <div class="version-tag">v1.2</div>
                    <span class="version-date">2026-01-06</span>
                </div>
                <div class="changelog-section">
                    <h4><i class="material-icons">add_circle</i> 新增功能</h4>
                    <ul>
                        <li><strong>票务动态看板</strong>：实时展示上新、开票、补票、回流等票务变动</li>
                        <li><strong>热力图多年份切换</strong>：支持 2023-2026 年度数据查看</li>
                        <li><strong>热力图视觉优化</strong>：采用 Sage Green 配色，更加美观</li>
                        <li><strong>版本更新日志</strong>：点击版本号可查看更新内容</li>
                    </ul>
                </div>
                <div class="changelog-section">
                    <h4><i class="material-icons">build</i> 问题修复</h4>
                    <ul>
                        <li>修复 Saoju 服务连接意外关闭的问题</li>
                        <li>优化 Hulaquan 数据库写入与网络 I/O 分离，提升稳定性</li>
                        <li>修复同场演员查询时的连接错误</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Celebration Content -->
    <div id="celebration-overlay" class="celebration-overlay">
        <div class="celebration-content">
            <h1 class="celebration-title">感谢您的宝贵建议</h1>
            <p class="celebration-subtitle">祝戏剧之神永在您身畔～</p>
        </div>
        <p id="close-hint" class="close-hint">(点击任意处关闭)</p>
        <div id="confetti-container"></div>
    </div>

    <!-- Heatmap Logic -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

    <script type="module" src="/static/js/main.js?v=20260105_1"></script>
    <script src="/static/js/feedback.js?v=20260105"></script>

</body>

</html>